name: Test Market Research Workflow

on:
  pull_request:
    paths:
      - '.github/workflows/market_research.yml'
      - 'scripts/market_research_csv_output.py'
      - 'tests/test_schema.py'
  workflow_dispatch:

jobs:
  test-workflow:
    runs-on: ubuntu-latest
    name: ğŸ§ª Test Market Research Components
    
    steps:
    - name: ğŸ”„ Checkout Repository
      uses: actions/checkout@v4
      
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: ğŸ“¦ Install Dependencies
      run: |
        pip install requests pandas pytest
        pip install python-dotenv beautifulsoup4
        
    - name: ğŸ”§ Test Script Syntax
      run: |
        # Test Python syntax
        python -m py_compile scripts/market_research_csv_output.py
        python -m py_compile tests/test_schema.py
        echo "âœ… Python syntax valid"
        
    - name: ğŸ§ª Run Mock Test
      run: |
        # Run with mock data (no API keys needed)
        python scripts/market_research_csv_output.py
        
        # Verify output
        if [ -d "research/$(date +%Y-%m-%d)" ]; then
          echo "âœ… Research directory created"
          ls -la research/$(date +%Y-%m-%d)/
        else
          echo "âŒ Research directory not created"
          exit 1
        fi
        
    - name: ğŸ“Š Validate Schema
      run: |
        # Run schema tests
        python tests/test_schema.py
        
    - name: ğŸ“ Workflow Syntax Check
      run: |
        # Validate YAML syntax
        echo "âœ… Workflow files syntax is valid (checked by GitHub)"
        
    - name: âœ… Test Summary
      run: |
        echo "ğŸ¯ All tests passed!"
        echo "ğŸ“‹ Components verified:"
        echo "  - Python scripts compile"
        echo "  - Mock data generation works" 
        echo "  - CSV schema is correct"
        echo "  - Directory structure created"
        echo ""
        echo "âš ï¸ Note: Live API tests require secrets to be configured"