# Pytest Configuration for AI KindleMint Engine
# This file configures test discovery, markers, coverage, and output formats.

[pytest]
# 1. Test Discovery Patterns
# ---------------------------
# Specifies where pytest should look for tests.
testpaths = tests
python_files = test_*.py *_test.py

# 5. Exclude Directories
# ----------------------
# Prevents pytest from searching for tests in these directories.
norecursedirs = .venv venv tmp_* tmp_deployment_test tmp_profiler_output .git books

# 2. Test Markers
# ---------------
# Registers custom markers to categorize tests and avoid warnings.
markers =
    performance: marks tests as performance benchmarks, which can be slow.

# 4. Test Output Format
# ---------------------
# Sets default command-line options for running tests.
addopts =
  -v                      # Verbose output
  -rA                     # Show a summary report for all test outcomes
  --showlocals            # Show local variables in tracebacks on failure
  --cov=scripts           # Measure coverage for the 'scripts' directory
  --cov-report=term-missing # Show missing lines in the terminal
  --cov-report=html       # Generate a detailed HTML report

# 3. Coverage Reporting
# ---------------------
# Configures the behavior of the pytest-cov plugin.

[coverage:run]
# Specifies the source code to measure coverage against.
source =
    scripts

[coverage:report]
# Fails the test suite if code coverage drops below this percentage.
fail_under = 70

# Includes a summary of missing lines in the terminal output.
show_missing = True

[coverage:html]
# Specifies the output directory for the detailed HTML report.
directory = reports/coverage_html

